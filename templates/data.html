<!DOCTYPE html>
<html>


<head>
    <title>Data Visualization</title>
    <link rel="stylesheet" href="/static/lib/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/lib/css/keen-dashboards.css">
</head>

<body class="application">
<a href="/">Home</a>
<a href="example.html">Example Distribution</a>
<a href="custom.html">New Distribution</a>
<a href="data.html">Visualize Data</a>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="./">Microbiology Malaria</a>
        </div>
    </div>
</div>

<div class="container-fluid">

    <div class="row">

        <div class="col-sm-6">
            <div class="row">

                <!-- Time Chart -->
                <div class="col-sm-12">
                    <div class="chart-wrapper">
                        <div class="chart-title">
                            Entry Collection Time Frame
                        </div>
                        <div class="chart-stage">
                            <div id="time-chart"></div>
                        </div>
                    </div>
                </div>
                <!-- Time Chart -->

                <!-- Species Pie -->
                <div class="col-sm-6">
                    <div class="chart-wrapper">
                        <div class="chart-title">
                            Species
                        </div>
                        <div class="chart-stage">
                            <div id="resource-type-row-chart"></div>
                        </div>
                    </div>
                </div>
                <!-- Species Pie -->

                <!-- Location Pie -->
                <div class="col-sm-6">
                    <div class="chart-wrapper">
                        <div class="chart-title">
                            Location Area
                        </div>
                        <div class="chart-stage">
                            <div id="poverty-level-row-chart"></div>
                        </div>
                    </div>
                </div>
                <!-- Location Pie -->

            </div>
        </div>

        <!--&lt;!&ndash; Map &ndash;&gt;-->
        <!--<div class="col-sm-6">-->
        <!--<div class="chart-wrapper">-->
        <!--<div class="chart-title">-->
        <!--Distribution of Donations-->
        <!--</div>-->
        <!--<div class="chart-stage">-->
        <!--<div id="us-chart"></div>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->
        <!--&lt;!&ndash; Map &ndash;&gt;-->

        <!-- Metric 1 -->
        <div class="col-sm-3">
            <div class="chart-wrapper">
                <div class="chart-title">
                    Total Number of Donations
                </div>
                <div class="chart-stage">
                    <div id="number-projects-nd"></div>
                </div>
            </div>
        </div>
        <!-- Metric 1 -->


        <!-- Metric 2 -->

    </div>

</div>

<hr>

</div>

<script src="/static/lib/js/jquery.min.js"></script>
<script src="/static/lib/js/bootstrap.min.js"></script>
<script src="/static/lib/js/holder.js"></script>
<script src="/static/lib/js/d3.js"></script>
<script src="/static/lib/js/dc.js"></script>
<script src="/static/lib/js/crossfilter.js"></script>
<script src="/static/lib/js/queue.js"></script>
<script>
    Holder.add_theme("white", {background: "#fff", foreground: "#a7a7a7", size: 10});
</script>

<script>
    queue()
        .defer(d3.json, "http://localhost:5000/data/visualization")
        .await(makeGraphs);

    function makeGraphs(error, projectsJson, statesJson) {

        //Clean projectsJson data
        var project = projectsJson;
        var dateFormat = d3.time.format("%Y-%d-%m %H:%M:%S");
        project.forEach(function (d) {
            d["date"] = dateFormat.parse(d["date"]);
        });


        //Create a Crossfilter instance
        var ndx = crossfilter(project);

        //Define Dimensions
        var dateDim = ndx.dimension(function (d) {
            return d["date"];
        });

        var SpeciesTypeDim = ndx.dimension(function (d) {
            return d["species"];
        });
        var LocationLevelDim = ndx.dimension(function (d) {
            return d["location"];
        });


        //Calculate metrics
        var numProjectsByDate = dateDim.group();
        var numProjectsBySpeciesType = SpeciesTypeDim.group();
        var totalentriesByLocation = LocationLevelDim.group();

        var all = ndx.groupAll();

        var minDate = dateDim.bottom(1)[0]["date"];
        var maxDate = dateDim.top(1)[0]["date"];

        //Charts
        var timeChart = dc.barChart("#time-chart");
        var SpeciesTypeChart = dc.pieChart("#resource-type-row-chart");
        var LocationLevelChart = dc.rowChart("#poverty-level-row-chart");
        var numberProjectsND = dc.numberDisplay("#number-projects-nd");

        numberProjectsND
            .formatNumber(d3.format("d"))
            .valueAccessor(function (d) {
                return d;
            })
            .group(all);


        timeChart
            .width(600)
            .height(160)
            .margins({top: 10, right: 50, bottom: 30, left: 50})
            .dimension(dateDim)
            .group(numProjectsByDate)
            .transitionDuration(500)
            .x(d3.time.scale().domain([minDate, maxDate]))
            .elasticY(true)
            .xAxisLabel("Year")
            .yAxis().ticks(4);



        SpeciesTypeChart
            .width(300)
            .height(250)
            .slicesCap(4)
            .innerRadius(100)
            .dimension(SpeciesTypeDim)
            .group(numProjectsBySpeciesType)
            .legend(dc.legend())
            // workaround for #703: not enough data is accessible through .label() to display percentages
            .on('pretransition', function (chart) {
                chart.selectAll('text.pie-slice').text(function (d) {
                    return d.data.key + ' ' + dc.utils.printSingleValue((d.endAngle - d.startAngle) / (2 * Math.PI) * 100) + '%';
                })
            });


        LocationLevelChart
            .width(300)
            .height(250)
            .dimension(LocationLevelDim)
            .group(totalentriesByLocation)
            .xAxis().ticks(4);


        dc.renderAll();

    };
</script>
</body>
</html>
